/*! For license information please see 136.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkcerita_di_sekitarmu=self.webpackChunkcerita_di_sekitarmu||[]).push([[136],{136:(n,e,t)=>{t.r(e),t.d(e,{default:()=>b});var r=t(943),a=t(612);function i(n){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(n)}function o(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,a,i,o,s=[],c=!0,u=!1;try{if(i=(t=t.call(n)).next,0===e){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=i.call(t)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(n){u=!0,a=n}finally{try{if(!c&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}(n,e)||function(n,e){if(n){if("string"==typeof n)return s(n,e);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(n,e):void 0}}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function c(){var n=v(),e=n.m(c),t=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(n){var e="function"==typeof n&&n.constructor;return!!e&&(e===t||"GeneratorFunction"===(e.displayName||e.name))}var a={throw:1,return:2,break:3,continue:3};function i(n){var e,t;return function(r){e||(e={stop:function(){return t(r.a,2)},catch:function(){return r.v},abrupt:function(n,e){return t(r.a,a[n],e)},delegateYield:function(n,a,i){return e.resultName=a,t(r.d,u(n),i)},finish:function(n){return t(r.f,n)}},t=function(n,t,a){r.p=e.prev,r.n=e.next;try{return n(t,a)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return n.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(c=function(){return{wrap:function(e,t,r,a){return n.w(i(e),t,r,a&&a.reverse())},isGeneratorFunction:r,mark:n.m,awrap:function(n,e){return new y(n,e)},AsyncIterator:p,async:function(n,e,t,a,o){return(r(e)?d:f)(i(n),e,t,a,o)},keys:l,values:u}})()}function u(n){if(null!=n){var e=n["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],t=0;if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}throw new TypeError(i(n)+" is not iterable")}function l(n){var e=Object(n),t=[];for(var r in e)t.unshift(r);return function n(){for(;t.length;)if((r=t.pop())in e)return n.value=r,n.done=!1,n;return n.done=!0,n}}function f(n,e,t,r,a){var i=d(n,e,t,r,a);return i.next().then((function(n){return n.done?n.value:i.next()}))}function d(n,e,t,r,a){return new p(v().w(n,e,t,r),a||Promise)}function p(n,e){function t(r,a,i,o){try{var s=n[r](a),c=s.value;return c instanceof y?e.resolve(c.v).then((function(n){t("next",n,i,o)}),(function(n){t("throw",n,i,o)})):e.resolve(c).then((function(n){s.value=n,i(s)}),(function(n){return t("throw",n,i,o)}))}catch(n){o(n)}}var r;this.next||(h(p.prototype),h(p.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),h(this,"_invoke",(function(n,a,i){function o(){return new e((function(e,r){t(n,i,e,r)}))}return r=r?r.then(o,o):o()}),!0)}function v(){var n,e,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function i(t,r,a,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return h(u,"_invoke",function(t,r,a){var i,s,c,u=0,l=a||[],f=!1,d={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return i=e,s=0,c=n,d.n=t,o}};function p(t,r){for(s=t,c=r,e=0;!f&&u&&!a&&e<l.length;e++){var a,i=l[e],p=d.p,v=i[2];t>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=n):i[0]<=p&&((a=t<2&&p<i[1])?(s=0,d.v=r,d.n=i[1]):p<v&&(a=t<3||i[0]>r||r>v)&&(i[4]=t,i[5]=r,d.n=v,s=0))}if(a||t>1)return o;throw f=!0,r}return function(a,l,v){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),s=l,c=v;(e=s<2?n:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,i){if(s||(a="next"),e=i[a]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=n}else if((e=(f=d.n<0)?c:t.call(r,d))!==o)break}catch(e){i=n,s=1,c=e}finally{u=1}}return{value:e,done:f}}}(t,a,i),!0),u}var o={};function s(){}function c(){}function u(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(h(e={},r,(function(){return this})),e),f=u.prototype=s.prototype=Object.create(l);function d(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,u):(n.__proto__=u,h(n,a,"GeneratorFunction")),n.prototype=Object.create(f),n}return c.prototype=u,h(f,"constructor",u),h(u,"constructor",c),c.displayName="GeneratorFunction",h(u,a,"GeneratorFunction"),h(f),h(f,a,"Generator"),h(f,r,(function(){return this})),h(f,"toString",(function(){return"[object Generator]"})),(v=function(){return{w:i,m:d}})()}function h(n,e,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(n){a=0}h=function(n,e,t,r){function i(e,t){h(n,e,(function(n){return this._invoke(e,t,n)}))}e?a?a(n,e,{value:t,enumerable:!r,configurable:!r,writable:!r}):n[e]=t:(i("next",0),i("throw",1),i("return",2))},h(n,e,t,r)}function y(n,e){this.v=n,this.k=e}function m(n,e,t,r,a,i,o){try{var s=n[i](o),c=s.value}catch(n){return void t(n)}s.done?e(c):Promise.resolve(c).then(r,a)}function g(n){return function(){var e=this,t=arguments;return new Promise((function(r,a){var i=n.apply(e,t);function o(n){m(i,r,a,o,s,"next",n)}function s(n){m(i,r,a,o,s,"throw",n)}o(void 0)}))}}const b={render:function(){return g(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.y.isLoggedIn()){n.next=2;break}return n.abrupt("return",'\n        <section class="offline-page">\n          <h1>Akses Ditolak</h1>\n          <p>Anda harus login untuk mengakses halaman ini.</p>\n        </section>\n      ');case 2:return n.abrupt("return",'\n      <section class="offline-page" aria-labelledby="offline-title">\n        <h1 id="offline-title" tabindex="0">üì± Mode Offline</h1>\n        \n        <div class="offline-status">\n          <div class="status-indicator '.concat(navigator.onLine?"online":"offline",'">\n            <span class="status-dot"></span>\n            <span class="status-text">\n              ').concat(navigator.onLine?"Anda sedang online":"Anda sedang offline",'\n            </span>\n          </div>\n        </div>\n\n        \x3c!-- Storage Info --\x3e\n        <div class="storage-info">\n          <h2>üíæ Penyimpanan Lokal</h2>\n          <div class="storage-stats">\n            <div class="stat-item">\n              <span class="stat-label">Cerita Tersimpan:</span>\n              <span class="stat-value" id="saved-stories-count">0</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Cerita Offline:</span>\n              <span class="stat-value" id="offline-stories-count">0</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">Cerita Favorit:</span>\n              <span class="stat-value" id="favorites-count">0</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Offline Stories Section --\x3e\n        <div class="offline-section">\n          <h2>‚è≥ Cerita Menunggu Sinkronisasi</h2>\n          <div id="offline-stories-list" class="offline-stories-list">\n            <p id="no-offline-stories" style="display: none;">Tidak ada cerita offline yang menunggu sinkronisasi.</p>\n          </div>\n        </div>\n\n        \x3c!-- Cached Stories Section --\x3e\n        <div class="cached-section">\n          <h2>üìÑ Cerita yang Disimpan</h2>\n          <div class="cached-controls">\n            <button id="refresh-cache" class="secondary-button">\n              üîÑ Refresh Data\n            </button>\n            <button id="clear-cache" class="secondary-button">\n              üóëÔ∏è Hapus Cache\n            </button>\n          </div>\n          <div id="cached-stories-list" class="story-list">\n            <p id="loading-cached">Memuat cerita yang disimpan...</p>\n          </div>\n        </div>\n\n        \x3c!-- Service Worker Status --\x3e\n        <div class="sw-section">\n          <h2>‚öôÔ∏è Status Service Worker</h2>\n          <div class="sw-status">\n            <div class="sw-info">\n              <span class="info-label">Status:</span>\n              <span class="info-value" id="sw-status">Memeriksa...</span>\n            </div>\n            <div class="sw-info">\n              <span class="info-label">Cache:</span>\n              <span class="info-value" id="sw-cache">Memeriksa...</span>\n            </div>\n            <button id="update-sw" class="secondary-button" style="display: none;">\n              üîÑ Update Service Worker\n            </button>\n          </div>\n        </div>\n      </section>\n    '));case 3:case"end":return n.stop()}}),n)})))()},afterRender:function(){var n=this;return g(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.y.isLoggedIn()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n._loadStorageInfo();case 4:return e.next=6,n._loadOfflineStories();case 6:return e.next=8,n._loadCachedStories();case 8:n._setupControls(),n._checkServiceWorker(),window.addEventListener("online",n._handleOnlineStatus.bind(n)),window.addEventListener("offline",n._handleOnlineStatus.bind(n));case 12:case"end":return e.stop()}}),e)})))()},_loadStorageInfo:function(){return g(c().mark((function n(){var e,t,a,i,s,u;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Promise.all([r.v.getStories(),r.v.getOfflineStories(),r.v.getFavorites()]);case 3:e=n.sent,t=o(e,3),a=t[0],i=t[1],s=t[2],u=i.filter((function(n){return!n.synced})),document.getElementById("saved-stories-count").textContent=a.length,document.getElementById("offline-stories-count").textContent=u.length,document.getElementById("favorites-count").textContent=s.length,n.next=17;break;case 14:n.prev=14,n.t0=n.catch(0);case 17:case"end":return n.stop()}}),n,null,[[0,14]])})))()},_loadOfflineStories:function(){var n=this;return g(c().mark((function e(){var t,a,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("offline-stories-list"),a=document.getElementById("no-offline-stories"),e.prev=2,e.next=5,r.v.getOfflineStories();case 5:if(i=e.sent,0!==(o=i.filter((function(n){return!n.synced}))).length){e.next=11;break}return t.innerHTML="",a.style.display="block",e.abrupt("return");case 11:a.style.display="none",t.innerHTML=o.map((function(e){return'\n        <div class="offline-story-item" data-story-id="'.concat(e.id,'">\n          <div class="offline-story-content">\n            <h4>').concat(n._extractTitle(e.description)||"Cerita Tanpa Judul",'</h4>\n            <p class="offline-story-desc">\n              ').concat(e.description.substring(0,100)).concat(e.description.length>100?"...":"",'\n            </p>\n            <div class="offline-story-meta">\n              <small>Dibuat: ').concat(new Date(e.createdAt).toLocaleDateString("id-ID"),"</small>\n              <small>Status: ").concat(e.synced?"Tersinkronisasi":"Menunggu",'</small>\n            </div>\n          </div>\n          <div class="offline-story-actions">\n            <button class="sync-single-btn" data-story-id="').concat(e.id,'">\n              Sinkronisasi\n            </button>\n            <button class="delete-offline-btn" data-story-id="').concat(e.id,'">\n              Hapus\n            </button>\n          </div>\n        </div>\n      ')})).join(""),n._setupOfflineStoryInteractions(),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),t.innerHTML="<p>Gagal memuat cerita offline.</p>";case 20:case"end":return e.stop()}}),e,null,[[2,16]])})))()},_loadCachedStories:function(){var n=this;return g(c().mark((function e(){var t,a,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("cached-stories-list"),a=document.getElementById("loading-cached"),e.prev=2,e.next=5,r.v.getStories();case 5:if(i=e.sent,a&&a.remove(),0!==i.length){e.next=10;break}return t.innerHTML='\n          <div style="text-align: center; padding: 40px;">\n            <p>Belum ada cerita yang disimpan secara lokal.</p>\n            <p>Buka <a href="#/beranda" class="link">Beranda</a> untuk memuat cerita.</p>\n          </div>\n        ',e.abrupt("return");case 10:t.innerHTML=i.map((function(e){var t=n._extractStoryDisplayInfo(e),r=e.lat&&e.lon;return'\n          <article class="story-card cached-card">\n            <div class="story-header">\n              <h3>'.concat(t.title,'</h3>\n              <span class="cached-badge">üì±</span>\n            </div>\n            \n            <img src="').concat(e.photoUrl,'"\n                 alt="Foto ilustrasi cerita ').concat(t.title,'"\n                 class="story-photo"\n                 loading="lazy"\n                 onerror="this.src=\'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkdhbWJhciB0aWRhayB0ZXJzZWRpYTwvdGV4dD48L3N2Zz4=\'">\n            \n            <div class="story-content">\n              <p>').concat(t.description,'</p>\n              <div class="story-meta">\n                <small>Lokasi: ').concat(r?"".concat(e.lat,", ").concat(e.lon):"Tidak tersedia","</small>\n                ").concat(t.dateInfo,"\n                <small>Disimpan: ").concat(new Date(e.cachedAt).toLocaleDateString("id-ID"),"</small>\n              </div>\n            </div>\n          </article>\n        ")})).join(""),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),t.innerHTML="<p>Gagal memuat cerita yang disimpan.</p>";case 17:case"end":return e.stop()}}),e,null,[[2,13]])})))()},_setupControls:function(){var n=this;document.getElementById("refresh-cache").addEventListener("click",(function(){return n._refreshCache()})),document.getElementById("clear-cache").addEventListener("click",(function(){return n._clearCache()})),document.getElementById("update-sw").addEventListener("click",(function(){return n._updateServiceWorker()}))},_setupOfflineStoryInteractions:function(){var n=this;document.querySelectorAll(".sync-single-btn").forEach((function(e){e.addEventListener("click",function(){var t=g(c().mark((function t(r){var a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=parseInt(e.dataset.storyId),t.next=3,n._syncSingleStory(a);case 3:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}())})),document.querySelectorAll(".delete-offline-btn").forEach((function(e){e.addEventListener("click",function(){var t=g(c().mark((function t(r){var a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=parseInt(e.dataset.storyId),t.next=3,n._deleteOfflineStory(a);case 3:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}())}))},_syncSingleStory:function(n){var e=this;return g(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.v.markOfflineStoryAsSynced(n);case 3:return alert("Cerita berhasil disinkronisasi!"),t.next=6,e._loadStorageInfo();case 6:return t.next=8,e._loadOfflineStories();case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),alert("Gagal menyinkronisasi cerita.");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},_deleteOfflineStory:function(n){var e=this;return g(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm("Apakah Anda yakin ingin menghapus cerita offline ini?")){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,r.v.deleteOfflineStory(n);case 5:return alert("Cerita offline berhasil dihapus!"),t.next=8,e._loadStorageInfo();case 8:return t.next=10,e._loadOfflineStories();case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(2),alert("Gagal menghapus cerita offline.");case 16:case"end":return t.stop()}}),t,null,[[2,12]])})))()},_refreshCache:function(){var n=this;return g(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.v.getStories();case 3:return t=e.sent,e.next=6,Promise.all(t.map((function(n){return r.v.deleteStory(n.id)})));case 6:return alert("Cache berhasil di-refresh. Silakan buka Beranda untuk memuat ulang data."),e.next=9,n._loadStorageInfo();case 9:return e.next=11,n._loadCachedStories();case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),alert("Gagal me-refresh cache.");case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))()},_clearCache:function(){return g(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(confirm("Apakah Anda yakin ingin menghapus semua data yang disimpan secara lokal?")){n.next=2;break}return n.abrupt("return");case 2:if(n.prev=2,!window.indexedDB){n.next=7;break}return n.next=6,r.v.init();case 6:window.indexedDB.deleteDatabase("CeritaDatabase");case 7:alert("Semua data lokal berhasil dihapus!"),setTimeout((function(){window.location.reload()}),1e3),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(2),alert("Gagal menghapus cache.");case 15:case"end":return n.stop()}}),n,null,[[2,11]])})))()},_checkServiceWorker:function(){return g(c().mark((function n(){var e,t,r,a,i,o;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e=document.getElementById("sw-status"),t=document.getElementById("sw-cache"),r=document.getElementById("update-sw"),n.prev=3,!("serviceWorker"in navigator)){n.next=24;break}return n.next=7,navigator.serviceWorker.ready;case 7:if(!(a=n.sent)){n.next=20;break}return e.textContent="Aktif",e.style.color="#28a745",n.next=13,caches.keys();case 13:i=n.sent,o=i.some((function(n){return n.includes("cerita-di-sekitarmu")})),t.textContent=o?"Tersedia":"Tidak tersedia",t.style.color=o?"#28a745":"#dc3545",a.addEventListener("updatefound",(function(){r.style.display="block"})),n.next=22;break;case 20:e.textContent="Tidak aktif",e.style.color="#dc3545";case 22:n.next=26;break;case 24:e.textContent="Tidak didukung",e.style.color="#dc3545";case 26:n.next=33;break;case 28:n.prev=28,n.t0=n.catch(3),e.textContent="Error",e.style.color="#dc3545";case 33:case"end":return n.stop()}}),n,null,[[3,28]])})))()},_updateServiceWorker:function(){return g(c().mark((function n(){var e;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!("serviceWorker"in navigator)){n.next=9;break}return n.next=4,navigator.serviceWorker.ready;case 4:return e=n.sent,n.next=7,e.update();case 7:alert("Service Worker diperbarui! Halaman akan dimuat ulang."),window.location.reload();case 9:n.next=15;break;case 11:n.prev=11,n.t0=n.catch(0),alert("Gagal memperbarui Service Worker.");case 15:case"end":return n.stop()}}),n,null,[[0,11]])})))()},_handleOnlineStatus:function(){var n=this,e=document.querySelector(".status-indicator"),t=document.querySelector(".status-text");navigator.onLine?(e.classList.remove("offline"),e.classList.add("online"),t.textContent="Anda sedang online",setTimeout((function(){n._loadStorageInfo(),n._loadOfflineStories()}),1e3)):(e.classList.remove("online"),e.classList.add("offline"),t.textContent="Anda sedang offline")},_extractTitle:function(n){if(n&&n.startsWith("**")&&n.includes("**\n")){var e=n.split("**\n");if(e.length>=2)return e[0].replace("**","").trim()}return null},_extractStoryDisplayInfo:function(n){var e="Cerita Tanpa Judul",t=n.description;if(n.description&&n.description.startsWith("**")&&n.description.includes("**\n")){var r=n.description.split("**\n");r.length>=2&&(e=r[0].replace("**","").trim(),t=r.slice(1).join("").trim())}"Cerita Tanpa Judul"===e&&n.name&&(e=n.name);var a="";if(n.createdAt)try{var i=new Date(n.createdAt);a="<small>Diposting: ".concat(i.toLocaleDateString("id-ID"),"</small>")}catch(n){}return{title:e,description:t,dateInfo:a}}}}}]);