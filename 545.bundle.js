/*! For license information please see 545.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkcerita_di_sekitarmu=self.webpackChunkcerita_di_sekitarmu||[]).push([[545],{545:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(481),a=n.n(r),o=n(778),i=n(221);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(){var e=f(),t=e.m(l),n=(Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__).constructor;function r(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===n||"GeneratorFunction"===(t.displayName||t.name))}var a={throw:1,return:2,break:3,continue:3};function o(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,a[e],t)},delegateYield:function(e,a,o){return t.resultName=a,n(r.d,s(e),o)},finish:function(e){return n(r.f,e)}},n=function(e,n,a){r.p=t.prev,r.n=t.next;try{return e(n,a)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(l=function(){return{wrap:function(t,n,r,a){return e.w(o(t),n,r,a&&a.reverse())},isGeneratorFunction:r,mark:e.m,awrap:function(e,t){return new h(e,t)},AsyncIterator:m,async:function(e,t,n,a,i){return(r(t)?p:d)(o(e),t,n,a,i)},keys:c,values:s}})()}function s(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(u(e)+" is not iterable")}function c(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}}function d(e,t,n,r,a){var o=p(e,t,n,r,a);return o.next().then((function(e){return e.done?e.value:o.next()}))}function p(e,t,n,r,a){return new m(f().w(e,t,n,r),a||Promise)}function m(e,t){function n(r,a,o,i){try{var u=e[r](a),l=u.value;return l instanceof h?t.resolve(l.v).then((function(e){n("next",e,o,i)}),(function(e){n("throw",e,o,i)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,i)}))}catch(e){i(e)}}var r;this.next||(y(m.prototype),y(m.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),y(this,"_invoke",(function(e,a,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}),!0)}function f(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var l=r&&r.prototype instanceof u?r:u,s=Object.create(l.prototype);return y(s,"_invoke",function(n,r,a){var o,u,l,s=0,c=a||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,u=0,l=e,p.n=n,i}};function m(n,r){for(u=n,l=r,t=0;!d&&s&&!a&&t<c.length;t++){var a,o=c[t],m=p.p,f=o[2];n>3?(a=f===r)&&(l=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=m&&((a=n<2&&m<o[1])?(u=0,p.v=r,p.n=o[1]):m<f&&(a=n<3||o[0]>r||r>f)&&(o[4]=n,o[5]=r,p.n=f,u=0))}if(a||n>1)return i;throw d=!0,r}return function(a,c,f){if(s>1)throw TypeError("Generator is already running");for(d&&1===c&&m(c,f),u=c,l=f;(t=u<2?e:l)||!d;){o||(u?u<3?(u>1&&(p.n=-1),m(u,l)):p.n=l:p.v=l);try{if(s=2,o){if(u||(a="next"),t=o[a]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,u<2&&(u=0)}else 1===u&&(t=o.return)&&t.call(o),u<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){o=e,u=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,a,o),!0),s}var i={};function u(){}function l(){}function s(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(y(t={},r,(function(){return this})),t),d=s.prototype=u.prototype=Object.create(c);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,y(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,y(d,"constructor",s),y(s,"constructor",l),l.displayName="GeneratorFunction",y(s,a,"GeneratorFunction"),y(d),y(d,a,"Generator"),y(d,r,(function(){return this})),y(d,"toString",(function(){return"[object Generator]"})),(f=function(){return{w:o,m:p}})()}function y(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}y=function(e,t,n,r){function o(t,n){y(e,t,(function(e){return this._invoke(t,n,e)}))}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},y(e,t,n,r)}function h(e,t){this.v=e,this.k=t}function b(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){return void n(e)}u.done?t(l):Promise.resolve(l).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){b(o,r,a,i,u,"next",e)}function u(e){b(o,r,a,i,u,"throw",e)}i(void 0)}))}}const g={_map:null,_marker:null,_latitude:null,_longitude:null,_stream:null,_capturedBlob:null,_isInitialized:!1,_markIcon:a().icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),render:function(){return v(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.y.isLoggedIn()){e.next=2;break}return e.abrupt("return",'\n        <section class="add-story" aria-labelledby="add-title">\n          <h1 id="add-title" tabindex="0">Akses Ditolak</h1>\n          <div style="text-align: center; padding: 40px;">\n            <p>Anda harus login untuk menambah cerita.</p>\n            <a href="#/login" class="link">Masuk</a> atau \n            <a href="#/register" class="link">Daftar akun baru</a>\n          </div>\n        </section>\n      ');case 2:return e.abrupt("return",'\n      <section class="add-story" aria-labelledby="add-title">\n        <h1 id="add-title" tabindex="0">Tambah Cerita Baru</h1>\n        <div class="form-container">\n          <form id="addStoryForm" aria-labelledby="add-title">\n            <p id="form-message" class="info-message" aria-live="polite" style="display:none;"></p>\n\n            \x3c!-- Map Picker --\x3e\n            <div class="form-section">\n              <h2>Pilih Lokasi Cerita</h2>\n              <p class="form-help">Klik pada peta untuk memilih lokasi cerita Anda (opsional)</p>\n              <div id="map-picker" style="height: 300px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #ddd;" \n                   aria-label="Peta untuk memilih lokasi cerita">\n                <div style="text-align: center; padding: 40px; color: #666;">\n                  <p>Memuat peta...</p>\n                </div>\n              </div>\n              \n              <div class="coordinates-display">\n                <div class="coordinate-field">\n                  <label for="latitude">Latitude:</label>\n                  <input type="text" id="latitude" name="lat" readonly aria-label="Latitude lokasi yang dipilih">\n                </div>\n                <div class="coordinate-field">\n                  <label for="longitude">Longitude:</label>\n                  <input type="text" id="longitude" name="lon" readonly aria-label="Longitude lokasi yang dipilih">\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Story Details --\x3e\n            <div class="form-section">\n              <h2>Detail Cerita</h2>\n              \n              <div class="form-group">\n                <label for="title">Judul Cerita:</label>\n                <input type="text" id="title" name="title" required aria-required="true" \n                       placeholder="Masukkan judul cerita Anda" aria-describedby="title-help">\n                <p id="title-help" class="form-help">Beri judul yang menarik untuk cerita Anda</p>\n                <p id="title-error" class="error-message" style="display:none;" aria-live="polite"></p>\n              </div>\n\n              <div class="form-group">\n                <label for="description">Deskripsi Cerita:</label>\n                <textarea id="description" name="description" required aria-required="true" \n                          placeholder="Tuliskan isi cerita Anda di sini..." \n                          rows="5" aria-describedby="description-help"></textarea>\n                <p id="description-help" class="form-help">Ceritakan pengalaman atau momen spesial Anda</p>\n                <p id="description-error" class="error-message" style="display:none;" aria-live="polite"></p>\n              </div>\n            </div>\n\n            \x3c!-- Photo Upload --\x3e\n            <div class="form-section">\n              <h2>Foto Cerita</h2>\n              \n              <div class="form-group">\n                <label for="photoType">Pilih Sumber Gambar:</label>\n                <select id="photoType" name="photoType" aria-describedby="photoType-help">\n                  <option value="file">Upload File Gambar</option>\n                  <option value="camera">Ambil dari Kamera</option>\n                </select>\n                <p id="photoType-help" class="form-help">Pilih cara untuk menambahkan foto cerita</p>\n              </div>\n\n              <div id="fileUploadContainer" class="upload-section">\n                <label for="photo">Upload Foto:</label>\n                <input type="file" id="photo" name="photo" accept="image/*" required aria-required="true"\n                       aria-describedby="photo-help">\n                <p id="photo-help" class="form-help">Format: JPG, PNG, GIF. Maksimal 5MB</p>\n                <div id="filePreview" class="image-preview" style="display:none;">\n                  <img id="filePreviewImage" src="#" alt="Pratinjau gambar yang diupload" style="max-width: 100%; max-height: 200px;">\n                </div>\n              </div>\n\n              <div id="cameraContainer" class="upload-section" style="display:none;">\n                <div class="camera-controls">\n                  <video id="videoElement" width="320" height="240" autoplay \n                         aria-label="Pratinjau kamera" style="border-radius: 8px;"></video>\n                  <canvas id="canvasElement" width="320" height="240" style="display:none;"></canvas>\n                  \n                  <div class="camera-buttons">\n                    <button type="button" id="captureButton" class="secondary-button">Ambil Foto</button>\n                    <button type="button" id="retakeButton" class="secondary-button" style="display:none;">Ambil Ulang</button>\n                  </div>\n                </div>\n                \n                <p id="camera-status" class="info-message" aria-live="polite" style="display:none;"></p>\n                \n                <div id="capturedImagePreview" class="image-preview" style="display:none;">\n                  <img id="capturedPreviewImage" src="#" alt="Pratinjau foto yang diambil" style="max-width: 100%; max-height: 200px;">\n                  <p class="form-help">Foto berhasil diambil! Klik "Ambil Ulang" jika ingin mengganti.</p>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Submit Button --\x3e\n            <div class="form-actions">\n              <button type="submit" id="submitButton" class="primary-button">\n                Kirim Cerita\n              </button>\n              <button type="button" id="cancelButton" class="secondary-button">\n                Batal\n              </button>\n            </div>\n          </form>\n        </div>\n      </section>\n    ');case 3:case"end":return e.stop()}}),e)})))()},afterRender:function(){var e=this;return v(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.y.isLoggedIn()){t.next=2;break}return t.abrupt("return");case 2:return e._isInitialized=!1,t.next=5,new Promise((function(e){return setTimeout(e,200)}));case 5:return t.prev=5,t.next=8,e._initMap();case 8:e._setupFormInteractivity(),e._isInitialized=!0,t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5);case 15:case"end":return t.stop()}}),t,null,[[5,12]])})))()},_initMap:function(){var e=this;return v(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){setTimeout((function(){try{if(!document.getElementById("map-picker"))return void n(new Error("Map container not found"));if(void 0===a())return void n(new Error("Leaflet library not found"));e._map&&(e._map.remove(),e._map=null),e._map=a().map("map-picker").setView([-6.2,106.8],5),a().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(e._map),e._map.on("click",(function(t){return e._onMapClick(t)})),e._marker=a().marker([-6.2,106.8],{icon:e._markIcon}).addTo(e._map).bindPopup("Lokasi default: Jakarta").openPopup(),e._latitude="-6.200000",e._longitude="106.800000";var r=document.getElementById("latitude"),o=document.getElementById("longitude");r&&(r.value=e._latitude),o&&(o.value=e._longitude),setTimeout((function(){e._map&&e._map.invalidateSize()}),100),t()}catch(e){var i=document.getElementById("map-picker");i&&(i.innerHTML='\n              <div style="text-align: center; padding: 40px; color: #666;">\n                <p>Gagal memuat peta. Pastikan koneksi internet Anda stabil.</p>\n                <p style="font-size: 12px; margin-top: 10px;">Error: '.concat(e.message,"</p>\n              </div>\n            ")),n(e)}}),100)})));case 1:case"end":return t.stop()}}),t)})))()},_onMapClick:function(e){if(this._map&&this._marker){this._marker&&this._map.removeLayer(this._marker),this._latitude=e.latlng.lat.toFixed(6),this._longitude=e.latlng.lng.toFixed(6),this._marker=a().marker([this._latitude,this._longitude],{icon:this._markIcon}).addTo(this._map).bindPopup("Lokasi terpilih: ".concat(this._latitude,", ").concat(this._longitude)).openPopup();var t=document.getElementById("latitude"),n=document.getElementById("longitude");t&&(t.value=this._latitude),n&&(n.value=this._longitude)}},_setupFormInteractivity:function(){var e=this;setTimeout((function(){var t=document.getElementById("addStoryForm");if(t){var n=document.getElementById("photoType"),r=document.getElementById("fileUploadContainer"),a=document.getElementById("cameraContainer"),i=document.getElementById("videoElement"),u=document.getElementById("canvasElement"),s=document.getElementById("captureButton"),c=document.getElementById("retakeButton"),d=document.getElementById("filePreview"),p=document.getElementById("filePreviewImage"),m=document.getElementById("capturedImagePreview"),f=document.getElementById("capturedPreviewImage"),y=document.getElementById("photo"),h=document.getElementById("form-message"),b=document.getElementById("cancelButton");if(n&&r&&a&&i&&u&&s&&c&&d&&p&&m&&f&&y&&h&&b){var g=null,k=function(){e._stream&&(e._stream.getTracks().forEach((function(e){return e.stop()})),e._stream=null,i.srcObject=null)};y.addEventListener("change",(function(e){var t=e.target.files[0];if(t){if(t.size>5242880)return h.textContent="Ukuran file terlalu besar. Maksimal 5MB.",h.style.backgroundColor="#fee",h.style.display="block",void(y.value="");var n=new FileReader;n.onload=function(e){p.src=e.target.result,d.style.display="block"},n.readAsDataURL(t)}})),n.addEventListener("change",function(){var t=v(l().mark((function t(n){var o,u,p,f;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.target.value,g=null,m.style.display="none",d.style.display="none",y.required="file"===o,"camera"!==o){t.next=27;break}return r.style.display="none",a.style.display="block",c.style.display="none",s.style.display="block",t.prev=10,t.next=13,navigator.mediaDevices.getUserMedia({video:{width:320,height:240}});case 13:e._stream=t.sent,i.srcObject=e._stream,(u=document.getElementById("camera-status"))&&(u.textContent="Kamera aktif. Silakan ambil foto.",u.style.display="block",u.style.backgroundColor="#e8f5e8"),t.next=25;break;case 19:t.prev=19,t.t0=t.catch(10),(p=document.getElementById("camera-status"))&&(p.textContent="Gagal mengakses kamera. Periksa izin perangkat Anda.",p.style.backgroundColor="#fee",p.style.display="block"),k();case 25:t.next=32;break;case 27:k(),a.style.display="none",r.style.display="block",(f=document.getElementById("camera-status"))&&(f.style.display="none");case 32:case"end":return t.stop()}}),t,null,[[10,19]])})));return function(e){return t.apply(this,arguments)}}()),s.addEventListener("click",(function(){if(e._stream){var t=u.getContext("2d");u.width=i.videoWidth,u.height=i.videoHeight,t.drawImage(i,0,0,u.width,u.height),u.toBlob((function(t){g=new File([t],"story-photo.png",{type:"image/png"}),e._capturedBlob=g,f.src=URL.createObjectURL(t),m.style.display="block",c.style.display="block",s.style.display="none";var n=document.getElementById("camera-status");n&&(n.textContent="Foto berhasil diambil!",n.style.backgroundColor="#e8f5e8"),k()}),"image/png")}})),c.addEventListener("click",v(l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m.style.display="none",c.style.display="none",s.style.display="block",g=null,e._capturedBlob=null,t.prev=5,t.next=8,navigator.mediaDevices.getUserMedia({video:{width:320,height:240}});case 8:e._stream=t.sent,i.srcObject=e._stream,(n=document.getElementById("camera-status"))&&(n.textContent="Kamera aktif. Silakan ambil foto.",n.style.backgroundColor="#e8f5e8"),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(5),(r=document.getElementById("camera-status"))&&(r.textContent="Gagal mengakses kamera.",r.style.backgroundColor="#fee");case 19:case"end":return t.stop()}}),t,null,[[5,14]])})))),b.addEventListener("click",(function(){confirm("Apakah Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang.")&&(k(),window.location.hash="#/beranda")})),e._closeMediaStream=k,t.addEventListener("submit",function(){var r=v(l().mark((function r(a){var i,u,s,c,d,p,m,f;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a.preventDefault(),h.style.display="none",e._validateForm(t)){r.next=8;break}return h.textContent="Mohon periksa input Anda. Pastikan semua field wajib diisi dengan benar.",h.style.backgroundColor="#fee",h.style.display="block",r.abrupt("return");case 8:if(i=new FormData(t),u=null,"camera"!==n.value||!e._capturedBlob){r.next=14;break}u=e._capturedBlob,r.next=22;break;case 14:if("file"!==n.value||!y.files[0]){r.next=18;break}u=y.files[0],r.next=22;break;case 18:return h.textContent="Mohon pilih atau ambil foto.",h.style.backgroundColor="#fee",h.style.display="block",r.abrupt("return");case 22:return s=i.get("title").trim(),c=i.get("description").trim(),d="**".concat(s,"**\n").concat(c),p={description:d,photo:u,lat:e._latitude?parseFloat(e._latitude):null,lon:e._longitude?parseFloat(e._longitude):null},(m=document.getElementById("submitButton")).disabled=!0,m.innerHTML="Mengirim...",h.textContent="Mengirim cerita Anda...",h.style.backgroundColor="#e3f2fd",h.style.display="block",r.prev=33,r.next=37,(0,o.y_)(p);case 37:if(!(f=r.sent).error){r.next=41;break}throw new Error(f.message||"Gagal mengirim data ke API.");case 41:h.textContent="Cerita berhasil ditambahkan! Mengarahkan ke Beranda...",h.style.backgroundColor="#e8f5e8",k(),setTimeout((function(){window.location.hash="#/beranda"}),2e3),r.next=54;break;case 47:r.prev=47,r.t0=r.catch(33),h.textContent="Gagal mengirim cerita: ".concat(r.t0.message),h.style.backgroundColor="#fee",m.disabled=!1,m.innerHTML="Kirim Cerita";case 54:case"end":return r.stop()}}),r,null,[[33,47]])})));return function(e){return r.apply(this,arguments)}}())}}}),100)},_validateForm:function(e){var t=!0,n=e.querySelector("#title"),r=e.querySelector("#description"),a=e.querySelector("#photoType"),o=e.querySelector("#photo"),i=document.querySelector("#title-error"),u=document.querySelector("#description-error");i&&(i.style.display="none",i.textContent=""),u&&(u.style.display="none",u.textContent=""),n.setCustomValidity(""),r.setCustomValidity("");var l=n.value.trim();l?l.length<2&&(i&&(i.textContent="Judul minimal 2 karakter.",i.style.display="block"),t=!1):(i&&(i.textContent="Judul cerita wajib diisi.",i.style.display="block"),t=!1);var s=r.value.trim();s?s.length<5&&(u&&(u.textContent="Deskripsi minimal 5 karakter.",u.style.display="block"),t=!1):(u&&(u.textContent="Deskripsi cerita wajib diisi.",u.style.display="block"),t=!1);var c=a.value;return"file"===c?o.files&&o.files[0]||(t=!1):"camera"===c&&(this._capturedBlob||(t=!1)),t},cleanup:function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null),this._map&&(this._map.remove(),this._map=null),this._marker=null,this._capturedBlob=null,this._isInitialized=!1,this._closeMediaStream&&window.removeEventListener("hashchange",this._closeMediaStream)}}},778:(e,t,n)=>{n.d(t,{DY:()=>_,Lx:()=>x,ZO:()=>b,y_:()=>g});var r=n(221);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(){var e=d(),t=e.m(o),n=(Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__).constructor;function r(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===n||"GeneratorFunction"===(t.displayName||t.name))}var a={throw:1,return:2,break:3,continue:3};function p(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,a[e],t)},delegateYield:function(e,a,o){return t.resultName=a,n(r.d,i(e),o)},finish:function(e){return n(r.f,e)}},n=function(e,n,a){r.p=t.prev,r.n=t.next;try{return e(n,a)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(o=function(){return{wrap:function(t,n,r,a){return e.w(p(t),n,r,a&&a.reverse())},isGeneratorFunction:r,mark:e.m,awrap:function(e,t){return new m(e,t)},AsyncIterator:c,async:function(e,t,n,a,o){return(r(t)?s:l)(p(e),t,n,a,o)},keys:u,values:i}})()}function i(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(a(e)+" is not iterable")}function u(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}}function l(e,t,n,r,a){var o=s(e,t,n,r,a);return o.next().then((function(e){return e.done?e.value:o.next()}))}function s(e,t,n,r,a){return new c(d().w(e,t,n,r),a||Promise)}function c(e,t){function n(r,a,o,i){try{var u=e[r](a),l=u.value;return l instanceof m?t.resolve(l.v).then((function(e){n("next",e,o,i)}),(function(e){n("throw",e,o,i)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,i)}))}catch(e){i(e)}}var r;this.next||(p(c.prototype),p(c.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),p(this,"_invoke",(function(e,a,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}),!0)}function d(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var l=r&&r.prototype instanceof u?r:u,s=Object.create(l.prototype);return p(s,"_invoke",function(n,r,a){var o,u,l,s=0,c=a||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,u=0,l=e,p.n=n,i}};function m(n,r){for(u=n,l=r,t=0;!d&&s&&!a&&t<c.length;t++){var a,o=c[t],m=p.p,f=o[2];n>3?(a=f===r)&&(l=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=m&&((a=n<2&&m<o[1])?(u=0,p.v=r,p.n=o[1]):m<f&&(a=n<3||o[0]>r||r>f)&&(o[4]=n,o[5]=r,p.n=f,u=0))}if(a||n>1)return i;throw d=!0,r}return function(a,c,f){if(s>1)throw TypeError("Generator is already running");for(d&&1===c&&m(c,f),u=c,l=f;(t=u<2?e:l)||!d;){o||(u?u<3?(u>1&&(p.n=-1),m(u,l)):p.n=l:p.v=l);try{if(s=2,o){if(u||(a="next"),t=o[a]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,u<2&&(u=0)}else 1===u&&(t=o.return)&&t.call(o),u<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){o=e,u=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,a,o),!0),s}var i={};function u(){}function l(){}function s(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(p(t={},r,(function(){return this})),t),m=s.prototype=u.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,p(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=s,p(m,"constructor",s),p(s,"constructor",l),l.displayName="GeneratorFunction",p(s,a,"GeneratorFunction"),p(m),p(m,a,"Generator"),p(m,r,(function(){return this})),p(m,"toString",(function(){return"[object Generator]"})),(d=function(){return{w:o,m:f}})()}function p(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}p=function(e,t,n,r){function o(t,n){p(e,t,(function(e){return this._invoke(t,n,e)}))}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},p(e,t,n,r)}function m(e,t){this.v=e,this.k=t}function f(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){return void n(e)}u.done?t(l):Promise.resolve(l).then(r,a)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){f(o,r,a,i,u,"next",e)}function u(e){f(o,r,a,i,u,"throw",e)}i(void 0)}))}}var h="https://story-api.dicoding.dev/v1";function b(){return v.apply(this,arguments)}function v(){return(v=y(o().mark((function e(){var t,n,a,i,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.y.getToken()){e.next=4;break}return e.abrupt("return",[]);case 4:return e.prev=4,n=new AbortController,a=setTimeout((function(){return n.abort()}),1e4),e.next=10,fetch("".concat(h,"/stories"),{headers:{Authorization:"Bearer ".concat(t)},signal:n.signal});case 10:if(i=e.sent,clearTimeout(a),i.ok){e.next=14;break}throw new Error("HTTP error! status: ".concat(i.status));case 14:return e.next=16,i.json();case 16:if(!(u=e.sent).error&&u.listStory){e.next=21;break}return e.abrupt("return",[]);case 21:return l=u.listStory.map((function(e){var t=e.photoUrl;return e.photoUrl&&e.photoUrl.startsWith("http")||(t="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkdhbWJhciB0aWRhayB0ZXJzZWRpYTwvdGV4dD48L3N2Zz4="),{id:e.id,name:e.name,description:e.description,photoUrl:t,lat:e.lat,lon:e.lon,createdAt:e.createdAt}})),e.abrupt("return",l);case 25:return e.prev=25,e.t0=e.catch(4),"AbortError"===e.t0.name||"TypeError"===e.t0.name&&e.t0.message.includes("Failed to fetch"),e.abrupt("return",[]);case 30:case"end":return e.stop()}}),e,null,[[4,25]])})))).apply(this,arguments)}function g(e){return k.apply(this,arguments)}function k(){return(k=y(o().mark((function e(t){var n,a,i,u,l,s,c,d,p,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.description,a=t.photo,i=t.lat,u=t.lon,l=r.y.getToken()){e.next=4;break}return e.abrupt("return",{error:!0,message:"Anda harus login untuk menambah cerita."});case 4:return(s=new FormData).append("description",n),s.append("photo",a),i&&s.append("lat",i),u&&s.append("lon",u),e.prev=9,c=new AbortController,d=setTimeout((function(){return c.abort()}),3e4),e.next=15,fetch("".concat(h,"/stories"),{method:"POST",body:s,headers:{Authorization:"Bearer ".concat(l)},signal:c.signal});case 15:return p=e.sent,clearTimeout(d),e.next=20,p.json();case 20:if(m=e.sent,p.ok&&!m.error){e.next=24;break}return e.abrupt("return",{error:!0,message:m.message||"Error ".concat(p.status,": ").concat(p.statusText)});case 24:return e.abrupt("return",m);case 28:if(e.prev=28,e.t0=e.catch(9),"AbortError"!==e.t0.name){e.next=33;break}return e.abrupt("return",{error:!0,message:"Request timeout - Server terlalu lama merespon."});case 33:if("TypeError"!==e.t0.name||!e.t0.message.includes("Failed to fetch")){e.next=35;break}return e.abrupt("return",{error:!0,message:"Gagal terhubung ke server. Periksa koneksi internet Anda."});case 35:return e.abrupt("return",{error:!0,message:"Gagal mengirim data: ".concat(e.t0.message)});case 36:case"end":return e.stop()}}),e,null,[[9,28]])})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=y(o().mark((function e(t){var n,r,a,i,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,r=t.password,e.prev=1,a=new AbortController,i=setTimeout((function(){return a.abort()}),1e4),e.next=6,fetch("".concat(h,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r}),signal:a.signal});case 6:return u=e.sent,clearTimeout(i),e.next=10,u.json();case 10:if(l=e.sent,u.ok){e.next=13;break}return e.abrupt("return",{error:!0,message:l.message||"Login gagal"});case 13:return e.abrupt("return",{error:!1,data:l});case 16:if(e.prev=16,e.t0=e.catch(1),"AbortError"!==e.t0.name){e.next=20;break}return e.abrupt("return",{error:!0,message:"Request timeout - Server terlalu lama merespon."});case 20:return e.abrupt("return",{error:!0,message:"Terjadi kesalahan jaringan"});case 21:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}function _(e){return I.apply(this,arguments)}function I(){return(I=y(o().mark((function e(t){var n,r,a,i,u,l,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=t.email,a=t.password,e.prev=1,i=new AbortController,u=setTimeout((function(){return i.abort()}),1e4),e.next=6,fetch("".concat(h,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:r,password:a}),signal:i.signal});case 6:return l=e.sent,clearTimeout(u),e.next=10,l.json();case 10:if(s=e.sent,l.ok){e.next=13;break}return e.abrupt("return",{error:!0,message:s.message||"Pendaftaran gagal"});case 13:return e.abrupt("return",{error:!1,data:s});case 16:if(e.prev=16,e.t0=e.catch(1),"AbortError"!==e.t0.name){e.next=20;break}return e.abrupt("return",{error:!0,message:"Request timeout - Server terlalu lama merespon."});case 20:return e.abrupt("return",{error:!0,message:"Terjadi kesalahan jaringan"});case 21:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}}}]);