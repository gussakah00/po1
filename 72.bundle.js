/*! For license information please see 72.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkcerita_di_sekitarmu=self.webpackChunkcerita_di_sekitarmu||[]).push([[72],{72:(e,t,r)=>{r.d(t,{v:()=>O});var n=["_relevancyScore"];function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){return(t=k(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(){var e=b(),t=e.m(p),r=(Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__).constructor;function n(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===r||"GeneratorFunction"===(t.displayName||t.name))}var o={throw:1,return:2,break:3,continue:3};function i(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,o[e],t)},delegateYield:function(e,o,i){return t.resultName=o,r(n.d,l(e),i)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(p=function(){return{wrap:function(t,r,n,o){return e.w(i(t),r,n,o&&o.reverse())},isGeneratorFunction:n,mark:e.m,awrap:function(e,t){return new m(e,t)},AsyncIterator:y,async:function(e,t,r,o,a){return(n(t)?d:h)(i(e),t,r,o,a)},keys:v,values:l}})()}function l(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(o(e)+" is not iterable")}function v(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}}function h(e,t,r,n,o){var i=d(e,t,r,n,o);return i.next().then((function(e){return e.done?e.value:i.next()}))}function d(e,t,r,n,o){return new y(b().w(e,t,r,n),o||Promise)}function y(e,t){function r(n,o,i,a){try{var u=e[n](o),c=u.value;return c instanceof m?t.resolve(c.v).then((function(e){r("next",e,i,a)}),(function(e){r("throw",e,i,a)})):t.resolve(c).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,a)}))}catch(e){a(e)}}var n;this.next||(w(y.prototype),w(y.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),w(this,"_invoke",(function(e,o,i){function a(){return new t((function(t,n){r(e,i,t,n)}))}return n=n?n.then(a,a):a()}),!0)}function b(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof u?n:u,s=Object.create(c.prototype);return w(s,"_invoke",function(r,n,o){var i,u,c,s=0,f=o||[],p=!1,l={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,r){return i=t,u=0,c=e,l.n=r,a}};function v(r,n){for(u=r,c=n,t=0;!p&&s&&!o&&t<f.length;t++){var o,i=f[t],v=l.p,h=i[2];r>3?(o=h===n)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=v&&((o=r<2&&v<i[1])?(u=0,l.v=n,l.n=i[1]):v<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,l.n=h,u=0))}if(o||r>1)return a;throw p=!0,n}return function(o,f,h){if(s>1)throw TypeError("Generator is already running");for(p&&1===f&&v(f,h),u=f,c=h;(t=u<2?e:c)||!p;){i||(u?u<3?(u>1&&(l.n=-1),v(u,c)):l.n=c:l.v=c);try{if(s=2,i){if(u||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,u<2&&(u=0)}else 1===u&&(t=i.return)&&t.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((t=(p=l.n<0)?c:r.call(n,l))!==a)break}catch(t){i=e,u=1,c=t}finally{s=1}}return{value:t,done:p}}}(r,o,i),!0),s}var a={};function u(){}function c(){}function s(){}t=Object.getPrototypeOf;var f=[][n]?t(t([][n]())):(w(t={},n,(function(){return this})),t),p=s.prototype=u.prototype=Object.create(f);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,w(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=s,w(p,"constructor",s),w(s,"constructor",c),c.displayName="GeneratorFunction",w(s,o,"GeneratorFunction"),w(p),w(p,o,"Generator"),w(p,n,(function(){return this})),w(p,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:i,m:l}})()}function w(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}w=function(e,t,r,n){function i(t,r){w(e,t,(function(e){return this._invoke(t,r,e)}))}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},w(e,t,r,n)}function m(e,t){this.v=e,this.k=t}function S(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){S(i,n,o,a,u,"next",e)}function u(e){S(i,n,o,a,u,"throw",e)}a(void 0)}))}}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,k(n.key),n)}}function k(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var O=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dbName="CeritaDatabase",this.version=8,this.db=null,this._isOpening=!1,this._openPromise=null},t=[{key:"init",value:(B=g(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isOpening){e.next=2;break}return e.abrupt("return",this._openPromise);case 2:return this._isOpening=!0,this._openPromise=new Promise((function(e,r){var n=indexedDB.open(t.dbName,t.version);n.onerror=function(){t._isOpening=!1,r(n.error)},n.onsuccess=function(){t.db=n.result,t._isOpening=!1,t.db.onerror=function(e){},t.db.onclose=function(){t.db=null,t._isOpening=!1},e(t.db)},n.onupgradeneeded=function(e){var t=e.target.result,r=e.oldVersion;if(r<1){var n=t.createObjectStore("stories",{keyPath:"id"});n.createIndex("createdAt","createdAt",{unique:!1}),n.createIndex("hasLocation","hasLocation",{unique:!1}),n.createIndex("name","name",{unique:!1}),n.createIndex("description","description",{unique:!1});var o=t.createObjectStore("offlineStories",{keyPath:"id",autoIncrement:!0});o.createIndex("createdAt","createdAt",{unique:!1}),o.createIndex("synced","synced",{unique:!1}),t.createObjectStore("favorites",{keyPath:"storyId"}).createIndex("addedAt","addedAt",{unique:!1})}if(r<8){var i=e.target.transaction.objectStore("offlineStories");i.indexNames.contains("synced")||i.createIndex("synced","synced",{unique:!1})}},n.onblocked=function(){t.db&&t.db.close()}})),e.abrupt("return",this._openPromise);case 5:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"_ensureDB",value:(I=g(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=4;break}return e.next=3,this.init();case 3:return e.abrupt("return");case 4:return e.prev=4,t=this.db.transaction([],"readonly"),e.next=8,new Promise((function(e,r){t.oncomplete=e,t.onerror=r}));case 8:e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(4),this.db=null,e.next=16,this.init();case 16:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return I.apply(this,arguments)})},{key:"saveStories",value:(A=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["stories"],"readwrite"),i=o.objectStore("stories");i.clear(),t.forEach((function(e){i.put(s(s({},e),{},{hasLocation:!(!e.lat||!e.lon),cachedAt:(new Date).toISOString()}))})),o.oncomplete=function(){return e()},o.onerror=function(){return n(o.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return A.apply(this,arguments)})},{key:"getStories",value:(D=g(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,r){var n=t.db.transaction(["stories"],"readonly").objectStore("stories").getAll();n.onsuccess=function(){return e(n.result||[])},n.onerror=function(){return r(n.error)}})));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return D.apply(this,arguments)})},{key:"deleteStory",value:(_=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["stories"],"readwrite").objectStore("stories").delete(t);o.onsuccess=function(){return e()},o.onerror=function(){return n(o.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return _.apply(this,arguments)})},{key:"saveOfflineStory",value:(P=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["offlineStories"],"readwrite").objectStore("offlineStories"),i=s(s({},t),{},{id:Date.now(),createdAt:(new Date).toISOString(),synced:!1}),a=o.add(i);a.onsuccess=function(){return e(i.id)},a.onerror=function(){return n(a.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return P.apply(this,arguments)})},{key:"getOfflineStories",value:(j=g(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,r){var n=t.db.transaction(["offlineStories"],"readonly").objectStore("offlineStories").getAll();n.onsuccess=function(){return e(n.result||[])},n.onerror=function(){return r(n.error)}})));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return j.apply(this,arguments)})},{key:"deleteOfflineStory",value:(O=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["offlineStories"],"readwrite").objectStore("offlineStories").delete(t);o.onsuccess=function(){return e()},o.onerror=function(){return n(o.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return O.apply(this,arguments)})},{key:"markOfflineStoryAsSynced",value:(k=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["offlineStories"],"readwrite").objectStore("offlineStories"),i=o.get(t);i.onsuccess=function(){var r=i.result;if(r){var a="string"==typeof t?parseInt(t):t;r.synced=!0,r.id=a;var u=o.put(r);u.onsuccess=function(){e()},u.onerror=function(e){n(e)}}else e()},i.onerror=function(e){n(e)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return k.apply(this,arguments)})},{key:"getUnsyncedStories",value:(S=g(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,r){var n=t.db.transaction(["offlineStories"],"readonly").objectStore("offlineStories").getAll();n.onsuccess=function(){try{var t=(n.result||[]).filter((function(e){return!1===e.synced||void 0===e.synced}));e(t)}catch(t){e([])}},n.onerror=function(e){r(e)}})));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return S.apply(this,arguments)})},{key:"syncOfflineStories",value:(m=g(p().mark((function e(){var t,r,n,o,i,u=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,this.getUnsyncedStories();case 4:if(t=e.sent,r={successful:[],failed:[]},0!==t.length){e.next=10;break}return e.abrupt("return",r);case 10:n=a(t),e.prev=11,i=p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.value,e.prev=1,e.next=5,new Promise((function(e,r){setTimeout((function(){Math.random()>.2?e({success:!0,id:t.id}):r(new Error("Sync simulation failed"))}),500)}));case 5:return e.next=7,u.markOfflineStoryAsSynced(t.id);case 7:r.successful.push(t.id),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),r.failed.push({id:t.id,error:e.t0.message});case 15:case"end":return e.stop()}}),e,null,[[1,11]])})),n.s();case 14:if((o=n.n()).done){e.next=18;break}return e.delegateYield(i(),"t0",16);case 16:e.next=14;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(11),n.e(e.t1);case 23:return e.prev=23,n.f(),e.finish(23);case 26:return e.abrupt("return",r);case 30:return e.prev=30,e.t2=e.catch(0),e.abrupt("return",{successful:[],failed:[]});case 34:case"end":return e.stop()}}),e,this,[[0,30],[11,20,23,26]])}))),function(){return m.apply(this,arguments)})},{key:"addFavorite",value:(w=g(p().mark((function e(t,r){var n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,o){var i=n.db.transaction(["favorites"],"readwrite").objectStore("favorites"),a=s(s({storyId:t},r),{},{addedAt:(new Date).toISOString()}),u=i.add(a);u.onsuccess=function(){return e()},u.onerror=function(){return o(u.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e,t){return w.apply(this,arguments)})},{key:"removeFavorite",value:(b=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["favorites"],"readwrite").objectStore("favorites").delete(t);o.onsuccess=function(){return e()},o.onerror=function(){return n(o.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return b.apply(this,arguments)})},{key:"getFavorites",value:(y=g(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,r){var n=t.db.transaction(["favorites"],"readonly").objectStore("favorites").getAll();n.onsuccess=function(){return e(n.result)},n.onerror=function(){return r(n.error)}})));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return y.apply(this,arguments)})},{key:"isFavorite",value:(d=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["favorites"],"readonly").objectStore("favorites").get(t);o.onsuccess=function(){return e(!!o.result)},o.onerror=function(){return n(o.error)}})));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return d.apply(this,arguments)})},{key:"searchStories",value:(h=g(p().mark((function e(t){var r,o,a,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t&&""!==t.trim()){e.next=7;break}return e.next=5,this.getStories();case 5:return r=e.sent,e.abrupt("return",r.sort((function(e,t){return new Date(t.createdAt)-new Date(e.createdAt)})));case 7:return e.next=9,this.getStories();case 9:return o=e.sent,a=t.toLowerCase().trim(),u=o.map((function(e){var t,r,n=0,o=(null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"",i=(null===(r=e.description)||void 0===r?void 0:r.toLowerCase())||"";o===a&&(n+=100),i===a&&(n+=80),o.startsWith(a)&&(n+=60),i.startsWith(a)&&(n+=40),o.includes(a)&&(n+=30),i.includes(a)&&(n+=20);var u=o.split(/\s+/),c=i.split(/\s+/);return u.forEach((function(e){e===a&&(n+=25),e.startsWith(a)&&(n+=15)})),c.forEach((function(e){e===a&&(n+=15),e.startsWith(a)&&(n+=10)})),s(s({},e),{},{_relevancyScore:n})})),c=u.filter((function(e){return e._relevancyScore>0})).sort((function(e,t){return t._relevancyScore-e._relevancyScore})),e.abrupt("return",c.map((function(e){return e._relevancyScore,i(e,n)})));case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",[]);case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return h.apply(this,arguments)})},{key:"filterStories",value:(v=g(p().mark((function e(){var t,r,n,o,i=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},e.prev=1,e.next=5,this.getStories();case 5:if(r=e.sent,t.hasLocation&&(r=r.filter((function(e){return e.lat&&e.lon}))),t.dateRange&&(r=r.filter((function(e){var r=new Date(e.createdAt);return r>=t.dateRange.start&&r<=t.dateRange.end}))),!t.favoritesOnly){e.next=16;break}return e.next=12,this.getFavorites();case 12:n=e.sent,o=n.map((function(e){return e.storyId})),r=r.filter((function(e){return o.includes(e.id)}));case 16:return e.abrupt("return",r);case 19:return e.prev=19,e.t0=e.catch(1),e.abrupt("return",[]);case 23:case"end":return e.stop()}}),e,this,[[1,19]])}))),function(){return v.apply(this,arguments)})},{key:"sortStories",value:(l=g(p().mark((function e(){var t,r,n,o,i=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"createdAt",r=i.length>1&&void 0!==i[1]?i[1]:"desc",n=i.length>2&&void 0!==i[2]?i[2]:null,e.prev=3,e.next=7,this.getStories();case 7:return o=e.sent,e.abrupt("return",o.sort((function(e,o){var i=e[t],a=o[t];"createdAt"===t&&(i=new Date(i),a=new Date(a));var u=0;if(u=i<a?-1:i>a?1:0,"desc"===r&&(u=-u),0===u&&n){var c=e[n.field],s=o[n.field],f=0;return c<s?f=-1:c>s&&(f=1),"desc"===n.order?-f:f}return u})));case 11:return e.prev=11,e.t0=e.catch(3),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(){return l.apply(this,arguments)})},{key:"getStats",value:(f=g(p().mark((function e(){var t,r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getStories();case 3:return t=e.sent,e.next=6,this.getOfflineStories();case 6:return r=e.sent,e.next=9,this.getFavorites();case 9:return n=e.sent,e.abrupt("return",{totalStories:t.length,storiesWithLocation:t.filter((function(e){return e.lat&&e.lon})).length,offlineStories:r.length,unsyncedStories:r.filter((function(e){return!e.synced})).length,favorites:n.length});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{totalStories:0,storiesWithLocation:0,offlineStories:0,unsyncedStories:0,favorites:0});case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return f.apply(this,arguments)})},{key:"getStoryById",value:(c=g(p().mark((function e(t){var r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,n){var o=r.db.transaction(["stories"],"readonly").objectStore("stories").get(t);o.onsuccess=function(){return e(o.result)},o.onerror=function(){return n(o.error)}})));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return c.apply(this,arguments)})},{key:"getStoriesPaginated",value:(u=g(p().mark((function e(){var t,r,n,o,i,a=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:1,r=a.length>1&&void 0!==a[1]?a[1]:10,e.prev=2,e.next=5,this.getStories();case 5:return n=e.sent,i=(o=(t-1)*r)+r,e.abrupt("return",{stories:n.slice(o,i),total:n.length,page:t,pageSize:r,totalPages:Math.ceil(n.length/r)});case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",{stories:[],total:0,page:1,pageSize:10,totalPages:0});case 15:case"end":return e.stop()}}),e,this,[[2,11]])}))),function(){return u.apply(this,arguments)})},{key:"clearDatabase",value:(o=g(p().mark((function e(){var t=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureDB();case 3:return e.abrupt("return",new Promise((function(e,r){var n=t.db.transaction(["stories","offlineStories","favorites"],"readwrite");n.objectStore("stories").clear(),n.objectStore("offlineStories").clear(),n.objectStore("favorites").clear(),n.oncomplete=function(){return e()},n.onerror=function(){return r(n.error)}})));case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return o.apply(this,arguments)})}],t&&x(e.prototype,t),r&&x(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,o,u,c,f,l,v,h,d,y,b,w,m,S,k,O,j,P,_,D,A,I,B}())}}]);